<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#21808D">
    <title>棚卸し管理アプリ</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNDAiIGhlaWdodD0iMjQwIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iMTgxMTQyMzc0Ij48L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMjQwIiBoZWlnaHQ9IjI0MCIgZmlsbD0iIzIxODA4RCIvPgogIDxyZWN0IHg9IjgwIiB5PSI4MCIgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjRkNGQ0Y5Ii8+CiAgPHJlY3QgeD0iMTYwIiB5PSI4NDAiIHdpZHRoPSI4MDA0dEIGOCIgaGVpZ2h0PSI4MDE5QDAyRUEiIGZpbGw9IiMyMTgwOEQiLz4KPC9zdmc+Cg==">
    
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- メイン画面 -->
        <div id="main-menu" class="screen active">
            <header class="app-header">
                <h1>棚卸し管理アプリ</h1>
                <p class="app-subtitle">JAN/QRコード対応 v1.1.0</p>
            </header>
            
            <div class="main-actions">
                <button onclick="showScreen('inventory-section')" class="btn btn--primary btn--lg btn--full-width">
                    棚卸し開始
                </button>
                
                <div class="action-grid">
                    <button onclick="showScreen('import-section')" class="btn btn--secondary">
                        データ取込
                    </button>
                    <button onclick="showScreen('export-section')" class="btn btn--secondary">
                        データ出力
                    </button>
                    <button onclick="showScreen('edit-section')" class="btn btn--secondary">
                        データ編集
                    </button>
                    <button onclick="showScreen('settings-section')" class="btn btn--secondary">
                        設定
                    </button>
                </div>
            </div>
            
            <div class="data-status">
                <div class="status-item">
                    <span class="status-label">商品マスタ:</span>
                    <span id="product-status" class="status-value">0件</span>
                </div>
                <div class="status-item">
                    <span class="status-label">在庫データ:</span>
                    <span id="stock-status" class="status-value">0件</span>
                </div>
                <div class="status-item">
                    <span class="status-label">棚卸し履歴:</span>
                    <span id="inventory-status" class="status-value">0件</span>
                </div>
            </div>
        </div>
        
        <!-- 棚卸し画面 -->
        <div id="inventory-section" class="screen">
            <header class="screen-header">
                <button onclick="showScreen('main-menu')" class="btn btn--outline btn--sm">← 戻る</button>
                <h2>棚卸し作業</h2>
            </header>
            
            <div class="inventory-form">
                <form id="inventory-form" onsubmit="handleInventorySubmit(event)">
                    <div class="card">
                        <div class="card__body">
                            <div class="form-group">
                                <label class="form-label">商品コード読み取り</label>
                                <div class="scan-controls">
                                    <button id="start-scan-btn" type="button" onclick="startQRScan()" class="btn btn--primary btn--full-width">
                                        QRスキャン開始
                                    </button>
                                    <button id="stop-scan-btn" type="button" onclick="stopQRScan()" class="btn btn--warning btn--full-width" style="display: none;">
                                        スキャン停止
                                    </button>
                                    <div id="qr-reader" class="qr-reader"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="product-code" class="form-label">JANコード/商品コード</label>
                                <input type="text" id="product-code" class="form-control" placeholder="JANコードまたは商品コードを入力" oninput="searchProduct()">
                            </div>
                            
                            <div class="form-group">
                                <label for="product-name" class="form-label">商品名</label>
                                <input type="text" id="product-name" class="form-control" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label for="lot-number" class="form-label">ロット番号</label>
                                <input type="text" id="lot-number" list="lot-list" class="form-control" placeholder="ロット番号を選択または入力">
                                <datalist id="lot-list"></datalist>
                            </div>
                            
                            <div class="form-group">
                                <label for="quantity" class="form-label">数量</label>
                                <input type="number" id="quantity" class="form-control" value="1" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="unit" class="form-label">単位</label>
                                <select id="unit" class="form-control">
                                    <option value="個">個</option>
                                    <option value="箱">箱</option>
                                    <option value="パック">パック</option>
                                    <option value="セット">セット</option>
                                    <option value="ケース">ケース</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="shelf-number" class="form-label">棚番号</label>
                                <input type="text" id="shelf-number" class="form-control" placeholder="任意入力">
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn--primary btn--full-width">
                                    登録
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- データ取込画面 -->
        <div id="import-section" class="screen">
            <header class="screen-header">
                <button onclick="showScreen('main-menu')" class="btn btn--outline btn--sm">← 戻る</button>
                <h2>データ取込</h2>
            </header>
            
            <div class="import-form">
                <div class="card">
                    <div class="card__body">
                        <div class="form-group">
                            <h3>商品マスタ取込</h3>
                            <p>商品マスタExcelファイルを選択してください。</p>
                            <p>A列: 商品コード、B列: 商品名、W列: JANコード</p>
                            <input type="file" id="product-file" class="form-control" accept=".xlsx, .xls">
                            <button onclick="importProductData()" class="btn btn--primary btn--full-width mt-8">
                                商品マスタ取込
                            </button>
                        </div>
                        
                        <div class="form-group mt-8">
                            <h3>在庫データ取込</h3>
                            <p>在庫データExcelファイルを選択してください。</p>
                            <p>A列: 商品コード、C列: 数量、J列: センター、P列: ロット</p>
                            <input type="file" id="stock-file" class="form-control" accept=".xlsx, .xls">
                            <button onclick="importStockData()" class="btn btn--primary btn--full-width mt-8">
                                在庫データ取込
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- データ出力画面 -->
        <div id="export-section" class="screen">
            <header class="screen-header">
                <button onclick="showScreen('main-menu')" class="btn btn--outline btn--sm">← 戻る</button>
                <h2>データ出力</h2>
            </header>
            
            <div class="export-form">
                <div class="card">
                    <div class="card__body">
                        <h3>棚卸しデータ出力</h3>
                        <p>現在 <span id="export-count">0</span> 件のデータがあります。</p>
                        
                        <div class="form-group">
                            <label class="form-label">出力形式</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="export-format" value="excel" checked>
                                    Excel形式 (.xlsx)
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="export-format" value="csv">
                                    CSV形式 (.csv)
                                </label>
                            </div>
                        </div>
                        
                        <button onclick="exportData()" class="btn btn--primary btn--full-width">
                            データ出力
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- データ編集画面 -->
        <div id="edit-section" class="screen">
            <header class="screen-header">
                <button onclick="showScreen('main-menu')" class="btn btn--outline btn--sm">← 戻る</button>
                <h2>データ編集</h2>
            </header>
            
            <div class="edit-controls">
                <div class="search-box">
                    <input type="text" id="search-input" class="form-control" placeholder="商品コードまたは商品名で検索">
                </div>
                <button onclick="clearAllData()" class="btn btn--warning btn--sm mt-8">
                    すべて削除
                </button>
            </div>
            
            <div id="edit-list" class="edit-list">
                <!-- 編集リストがここに表示されます -->
            </div>
        </div>
        
        <!-- 設定画面 -->
        <div id="settings-section" class="screen">
            <header class="screen-header">
                <button onclick="showScreen('main-menu')" class="btn btn--outline btn--sm">← 戻る</button>
                <h2>設定</h2>
            </header>
            
            <div class="settings-form">
                <div class="card">
                    <div class="card__body">
                        <div class="form-group">
                            <label for="person-name" class="form-label">担当者名</label>
                            <input type="text" id="person-name" class="form-control" placeholder="担当者名を入力">
                        </div>
                        
                        <div class="form-group">
                            <label for="center-name" class="form-label">センター名</label>
                            <select id="center-name" class="form-control">
                                <option value="">センターを選択</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="beep-enabled" checked>
                                読み取り音を有効にする
                            </label>
                        </div>
                        
                        <button onclick="saveSettings()" class="btn btn--primary btn--full-width">
                            設定を保存
                        </button>
                        
                        <button onclick="createBackup()" class="btn btn--secondary btn--full-width mt-8">
                            バックアップ作成
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 編集モーダル -->
        <div id="edit-modal" class="modal">
            <div class="modal-content">
                <h3>データ編集</h3>
                
                <div class="form-group">
                    <label for="edit-product-code" class="form-label">商品コード</label>
                    <input type="text" id="edit-product-code" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label for="edit-product-name" class="form-label">商品名</label>
                    <input type="text" id="edit-product-name" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label for="edit-quantity" class="form-label">数量</label>
                    <input type="number" id="edit-quantity" class="form-control" min="0">
                </div>
                
                <div class="form-group">
                    <label for="edit-unit" class="form-label">単位</label>
                    <select id="edit-unit" class="form-control">
                        <option value="個">個</option>
                        <option value="箱">箱</option>
                        <option value="パック">パック</option>
                        <option value="セット">セット</option>
                        <option value="ケース">ケース</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-lot-number" class="form-label">ロット番号</label>
                    <input type="text" id="edit-lot-number" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="edit-shelf-number" class="form-label">棚番号</label>
                    <input type="text" id="edit-shelf-number" class="form-control">
                </div>
                
                <div class="modal-buttons">
                    <button onclick="saveEdit()" class="btn btn--primary">保存</button>
                    <button onclick="closeEditModal()" class="btn btn--secondary">キャンセル</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ローディングオーバーレイ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>処理中...</p>
    </div>
    
    <!-- トースト通知 -->
    <div id="toast" class="toast"></div>
    
    <script src="app.js"></script>
</body>
</html>